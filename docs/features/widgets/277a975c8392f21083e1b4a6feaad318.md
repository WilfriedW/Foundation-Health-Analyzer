# Widget FHA Documentation

**Page ID**: `277a975c8392f21083e1b4a6feaad318`  
**Widget**: `FHA Documentation` (`sp_widget_5ada939c8392f21083e1b4a6feaad360`)  
**Widget ID**: `5ada939c8392f21083e1b4a6feaad360`  
**App version**: `x_1310794_founda_0.version` (default: `1.1.0`)  
**Doc version**: `1.2.0-doc`  
**Last updated**: 2026-01-16

---

## Table des matières

1. [Description](#description)
2. [Architecture technique](#architecture-technique)
3. [Configuration](#configuration)
4. [Fonctionnalités](#fonctionnalités)
5. [Navigation et UX](#navigation-et-ux)
6. [Styling et CSS](#styling-et-css)
7. [Internationalisation](#internationalisation)
8. [Cas d'usage](#cas-dusage)
9. [Bonnes pratiques](#bonnes-pratiques)
10. [Dépendances](#dépendances)
11. [Références](#références)

---

## Description

Widget Service Portal interactif qui expose la documentation complète de l'application **Foundation Health Analyzer** directement dans le portail ServiceNow. 

### Résumé rapide

| Propriété | Valeur |
|-----------|---------|
| **Type** | Service Portal Widget (AngularJS) |
| **Audience** | Administrateurs ServiceNow, développeurs, équipes gouvernance |
| **Objectif** | Documentation in-app pour expliquer les options, scores, checks et API FHA |
| **URL d'accès** | `/fha?id=fha_documentation` |
| **Scope** | `x_1310794_founda_0` (Foundation Health Analyzer) |

### Emplacement des fichiers

- **Page Service Portal** : `sp_page_277a975c8392f21083e1b4a6feaad318.xml`
- **Widget** : `sp_widget_5ada939c8392f21083e1b4a6feaad360.xml`
- **Instance widget** : `sp_instance_148ddbd083d2f21083e1b4a6feaad31d.xml`
- **Dossier source** : `d852994c8312321083e1b4a6feaad3e6/update/`

---

## Architecture technique

### Vue d'ensemble

Le widget suit une architecture MVC avec les composants suivants :

```
┌─────────────────────────────────────┐
│       Template HTML (View)          │
│  - En-tête avec métadonnées         │
│  - Navigation sticky                │
│  - 10 sections documentaires        │
│  - Footer avec version              │
└─────────────────────────────────────┘
           ↓
┌─────────────────────────────────────┐
│   Client Script (Controller)        │
│  - Gestion navigation               │
│  - Scroll spy (IntersectionObserver)│
│  - Event handlers                   │
└─────────────────────────────────────┘
           ↓
┌─────────────────────────────────────┐
│      Server Script (Model)          │
│  - Lecture system properties        │
│  - Exposition des données           │
└─────────────────────────────────────┘
```

### Composants détaillés

#### 1. Server Script (Serveur)

**Fichier** : `script` section du widget XML

```javascript
(function() {
    data.appVersion = (typeof gs !== 'undefined' && gs.getProperty) 
        ? gs.getProperty('x_1310794_founda_0.version', '1.1.0') 
        : '1.1.0';
    data.lastUpdated = (typeof gs !== 'undefined' && gs.getProperty) 
        ? gs.getProperty('x_1310794_founda_0.doc.last_updated', '2026-01-14') 
        : '2026-01-14';
    data.pageId = '277a975c8392f21083e1b4a6feaad318';
    data.widgetId = '5ada939c8392f21083e1b4a6feaad360';
})();
```

**Données exposées** :

| Variable | Type | Source | Fallback | Description |
|----------|------|--------|----------|-------------|
| `data.appVersion` | `string` | `gs.getProperty('x_1310794_founda_0.version')` | `'1.1.0'` | Version de l'application FHA |
| `data.lastUpdated` | `string` | `gs.getProperty('x_1310794_founda_0.doc.last_updated')` | `'2026-01-14'` | Date de dernière mise à jour |
| `data.pageId` | `string` | Hardcodé | N/A | sys_id de la page Service Portal |
| `data.widgetId` | `string` | Hardcodé | N/A | sys_id du widget |

#### 2. Client Script (Client AngularJS)

**Fichier** : `client_script` section du widget XML

**Variables d'état** :

```javascript
c.activeSection = 'description';  // Section active par défaut
var sectionIds = [
    'description', 'installation', 'configuration', 
    'options', 'scores', 'checks', 'architecture', 
    'api', 'best-practices', 'resources'
];
var observer = null;  // IntersectionObserver instance
```

**Méthodes publiques** :

| Méthode | Signature | Description | Utilisation |
|---------|-----------|-------------|-------------|
| `setSection` | `setSection(sectionId)` | Définit la section active manuellement | Navigation programmatique |
| `scrollToSection` | `scrollToSection(sectionId)` | Scroll smooth vers une ancre | Clic sur boutons navigation |
| `goToDashboard` | `goToDashboard()` | Retour au dashboard FHA | Bouton "Back to dashboard" |

**Fonctionnalité Scroll Spy** :

Utilise l'API `IntersectionObserver` native du navigateur pour suivre la section visible :

```javascript
function setActiveFromViewport(entries) {
    entries.forEach(function(entry) {
        if (entry.isIntersecting && entry.target && entry.target.id) {
            c.activeSection = entry.target.id;
            $scope.$applyAsync();
        }
    });
}

function initScrollSpy() {
    if (!('IntersectionObserver' in window)) return;
    
    observer = new IntersectionObserver(setActiveFromViewport, { 
        threshold: 0.35 
    });
    
    sectionIds.forEach(function(id) {
        var el = document.getElementById(id);
        if (el) observer.observe(el);
    });
}
```

**Configuration IntersectionObserver** :
- `threshold: 0.35` → La section devient active quand 35% est visible
- Déconnexion propre sur `$destroy` pour éviter les fuites mémoire

#### 3. Template HTML

Le template contient **10 sections documentaires** complètes :

1. **Description** (`#description`) - Vue d'ensemble et cas d'usage
2. **Installation** (`#installation`) - Accès, prérequis, dépendances
3. **Configuration** (`#configuration`) - Paramètres et données exposées
4. **Options** (`#options`) - Options d'analyse (deep_scan, child tables, etc.)
5. **Scores** (`#scores`) - Calcul et interprétation du health score
6. **Checks** (`#checks`) - Modules de vérification (Table, Automation, Integration)
7. **Architecture** (`#architecture`) - Diagramme technique et modèle de données
8. **API** (`#api`) - Endpoints REST et exemples
9. **Best Practices** (`#best-practices`) - Bonnes pratiques et avertissements
10. **Resources** (`#resources`) - Liens, fichiers sources, changelog

---

## Configuration

### Paramètres du widget

**Aucun paramètre requis** - Le widget fonctionne en mode autonome.

| Paramètre | Type | Requis | Défaut | Description |
|-----------|------|--------|--------|-------------|
| `widget_parameters` | `Object` | Non | `{}` | Aucun paramètre attendu |

### System Properties utilisées

| Propriété | Valeur par défaut | Description | Impact |
|-----------|-------------------|-------------|--------|
| `x_1310794_founda_0.version` | `1.1.0` | Version de l'application | Affichée dans l'en-tête |
| `x_1310794_founda_0.doc.last_updated` | `2026-01-14` | Date de dernière modification | Affichée dans l'en-tête et footer |
| `x_1310794_founda_0.debug` | `false` | Active les logs serveur | Mentionnée dans la doc |

### Accès et permissions

**Rôles requis** (au moins un) :
- `x_1310794_founda_0.admin` - Administrateur FHA
- `x_1310794_founda_0.user` - Utilisateur FHA

**Prérequis** :
- Service Portal activé sur l'instance
- AngularJS et Font Awesome (fournis par ServiceNow)

---

## Fonctionnalités

### 1. Navigation intelligente

**Navigation sticky** avec boutons interactifs :

```html
<div class="fha-doc-nav">
    <div class="fha-doc-nav-items">
        <button class="fha-doc-nav-btn" 
                ng-class="{'active': c.activeSection === 'description'}" 
                ng-click="c.scrollToSection('description')">
            <i class="fa fa-info-circle"></i> ${Description}
        </button>
        <!-- ... 9 autres boutons -->
    </div>
</div>
```

**Caractéristiques** :
- Position `sticky` (reste visible au scroll)
- Mise en surbrillance automatique de la section active
- Scroll smooth au clic
- Icônes Font Awesome pour chaque section

### 2. Scroll Spy automatique

**Comportement** :
- Détecte automatiquement la section visible pendant le scroll
- Met à jour la navigation sans intervention utilisateur
- Threshold de 35% pour une activation fluide
- Compatible avec tous les navigateurs modernes
- Fallback gracieux si `IntersectionObserver` non supporté

### 3. Affichage des métadonnées

L'en-tête expose dynamiquement :

```html
<div class="fha-doc-meta">
    <span class="fha-doc-meta-item">${Page ID}: {{c.data.pageId}}</span>
    <span class="fha-doc-meta-item">${Widget ID}: {{c.data.widgetId}}</span>
    <span class="fha-doc-meta-item">${Scope}: x_1310794_founda_0</span>
    <span class="fha-doc-meta-item">${Last updated}: {{c.data.lastUpdated}}</span>
</div>
```

### 4. Retour au dashboard

Bouton rapide pour revenir au tableau de bord :

```javascript
c.goToDashboard = function() {
    window.location.href = '/fha?id=fha_homepage';
};
```

---

## Navigation et UX

### Structure de navigation

**10 sections accessibles** via la barre de navigation :

| Section | Icône | Ancre | Contenu |
|---------|-------|-------|---------|
| Description | `fa-info-circle` | `#description` | Vue d'ensemble, rôle, cas d'usage |
| Installation | `fa-download` | `#installation` | Accès, prérequis, versions |
| Configuration | `fa-sliders-h` | `#configuration` | Paramètres, données, méthodes |
| Options | `fa-cog` | `#options` | Options d'analyse FHA |
| Scores | `fa-chart-pie` | `#scores` | Calcul et interprétation |
| Checks | `fa-check-circle` | `#checks` | Modules de vérification |
| Architecture | `fa-code` | `#architecture` | Diagrammes et modèle |
| REST API | `fa-plug` | `#api` | Endpoints et exemples |
| Best Practices | `fa-shield-alt` | `#best-practices` | Recommandations |
| Resources | `fa-bookmark` | `#resources` | Liens et changelog |

### Expérience utilisateur

**Points forts** :
- ✅ Navigation sticky toujours accessible
- ✅ Scroll spy pour savoir où on est
- ✅ Smooth scroll pour transitions fluides
- ✅ Icônes visuelles pour identification rapide
- ✅ Responsive (grid CSS adaptatif)
- ✅ Sections clairement délimitées
- ✅ Badges de couleur pour sévérités/scores

---

## Styling et CSS

### Palette de couleurs

Le widget utilise une palette cohérente avec l'identité FHA :

```css
/* Couleurs principales */
--fha-primary: #1a5a96;       /* Bleu FHA */
--fha-primary-light: #2980b9;  /* Bleu clair */
--fha-accent: #e8f4fc;         /* Bleu très clair */

/* Sévérités */
--fha-severity-high: #dc2626 / #fee2e2;     /* Rouge */
--fha-severity-medium: #d97706 / #fef3c7;   /* Orange */
--fha-severity-low: #2563eb / #dbeafe;      /* Bleu */

/* Scores */
--fha-score-good: #059669 / #d1fae5;        /* Vert */
--fha-score-warning: #d97706 / #fef3c7;     /* Orange */
--fha-score-critical: #dc2626 / #fee2e2;    /* Rouge */
```

### Classes CSS principales

#### Layout

| Classe | Description | Propriétés clés |
|--------|-------------|-----------------|
| `.fha-doc-container` | Conteneur principal | `max-width: 1200px`, centré |
| `.fha-doc-header` | En-tête avec dégradé | Gradient bleu, padding 40px |
| `.fha-doc-nav` | Barre de navigation | `position: sticky`, `top: 10px`, `z-index: 100` |
| `.fha-doc-section` | Section de contenu | Background blanc, border-radius 12px |

#### Navigation

| Classe | Description | États |
|--------|-------------|-------|
| `.fha-doc-nav-btn` | Bouton de navigation | `.active` → background bleu |
| `.fha-doc-nav-items` | Container flex | `flex-wrap: wrap`, `gap: 10px` |

#### Composants visuels

| Classe | Usage | Style |
|--------|-------|-------|
| `.fha-severity-badge` | Badges de sévérité | Padding, border-radius, couleurs |
| `.fha-score-indicator` | Indicateurs de score | Inline-flex, gap, icons |
| `.fha-code-block` | Blocs de code | Background sombre, Monaco font |
| `.fha-code-inline` | Code inline | Background gris clair |
| `.fha-info-box` | Encadrés d'info | Border-left colorée, variants |
| `.fha-doc-table` | Tableaux | Border-collapse, hover states |

#### Architecture visuelle

Classes spéciales pour le diagramme d'architecture :

```css
.fha-arch-visual     /* Container du diagramme */
.fha-arch-layer      /* Couche architecturale */
.fha-arch-ui         /* Couche UI (bleu) */
.fha-arch-entry      /* Couche Entry (vert) */
.fha-arch-engine     /* Couche Engine (orange) */
.fha-arch-context    /* Couche Context (violet) */
.fha-arch-checks     /* Grid des checks */
```

### Responsive Design

Le CSS utilise des grids adaptatifs :

```css
.fha-feature-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.fha-arch-checks {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}
```

**Comportement** :
- Sur desktop : 3-4 colonnes
- Sur tablette : 2 colonnes
- Sur mobile : 1 colonne

### Typographie

```css
/* Titres */
.fha-doc-header h1     /* 32px, font-weight: 600 */
.fha-doc-section h2    /* 24px, color: #1a5a96 */
.fha-doc-section h3    /* 18px, color: #333 */

/* Corps de texte */
.fha-doc-section p     /* line-height: 1.7, color: #555 */

/* Code */
.fha-code-block        /* Monaco, Menlo, monospace, 13px */
.fha-code-inline       /* Monaco, Menlo, monospace, 13px */
```

---

## Internationalisation

### Système de labels

Le widget utilise la syntaxe ServiceNow pour l'internationalisation :

```html
<h1>${FHA Documentation}</h1>
<p>${Technical guide for the FHA documentation widget}</p>
<button ng-click="c.scrollToSection('description')">
    <i class="fa fa-info-circle"></i> ${Description}
</button>
```

**Syntaxe** : `${Label Key}`

### Labels utilisés

Le widget contient **plus de 150 labels traduis ibles** couvrant :

- Titres de sections
- Labels de boutons
- Descriptions de tableaux
- Messages informatifs
- Exemples de code commentés

### Configuration i18n

Pour ajouter/modifier des traductions :

1. **Navigation** : System Localization > Field Labels
2. **Table** : `sp_widget`
3. **Champ** : `template`
4. **Langue** : Sélectionner la langue cible
5. **Modifier** : Les clés `${...}` dans le template

**Langues supportées** (dépend de l'instance) :
- Anglais (par défaut)
- Français
- Allemand
- Espagnol
- Autres selon configuration instance

---

## Cas d'usage

### 1. Onboarding d'administrateurs

**Scénario** : Nouveau membre de l'équipe découvre FHA

**Workflow** :
1. Accès via `/fha?id=fha_documentation`
2. Lecture section "Description" pour comprendre l'outil
3. Section "Installation" pour vérifier l'accès
4. Section "Configuration" pour première analyse
5. Section "Scores" pour interpréter les résultats

**Bénéfice** : Documentation in-app, pas besoin de documents externes

### 2. Configuration d'analyse avancée

**Scénario** : Admin veut activer le deep scan

**Workflow** :
1. Scroll vers section "Options"
2. Lecture de la carte "Deep Scan"
3. Compréhension des détections (current.update, eval, etc.)
4. Navigation vers la page de configuration FHA
5. Activation de l'option en connaissance de cause

**Bénéfice** : Explications contextuelles des options

### 3. Intégration API externe

**Scénario** : Développeur veut automatiser les analyses

**Workflow** :
1. Scroll vers section "REST API"
2. Consultation des endpoints disponibles
3. Copie de l'exemple d'appel POST
4. Test avec curl/Postman
5. Implémentation dans script d'automatisation

**Bénéfice** : Exemples prêts à l'emploi, pas de recherche externe

### 4. Troubleshooting

**Scénario** : Problème de performance d'analyse

**Workflow** :
1. Section "Best Practices" → "Performance"
2. Découverte de la recommandation sur deep_scan
3. Section "Options" → Détails du deep scan
4. Désactivation si non nécessaire
5. Section "Configuration" → System property debug

**Bénéfice** : Documentation complète pour résolution autonome

---

## Bonnes pratiques

### Pour les administrateurs

#### 1. Maintien de la cohérence

✅ **À faire** :
- Synchroniser `x_1310794_founda_0.doc.last_updated` avec `CHANGELOG.md`
- Mettre à jour `x_1310794_founda_0.version` à chaque release
- Vérifier que les exemples de code restent valides

❌ **À éviter** :
- Modifier directement le template sans versionner
- Ajouter des liens externes si l'instance est déconnectée
- Oublier de tester les boutons de navigation

#### 2. Performance

✅ **Recommandations** :
- Le widget est léger (pas d'appels API externes)
- CSS inline pour performance optimale
- IntersectionObserver natif (pas de polling)

#### 3. Sécurité

✅ **Points de vigilance** :
- Les rôles FHA doivent être configurés sur la page
- Pas de données sensibles dans le template (OK actuellement)
- Les ACLs REST API doivent être configurées séparément

⚠️ **Avertissement du widget** :
> "The widget does not validate API rights; ACLs and REST roles must be configured on the platform."

### Pour les développeurs

#### 1. Extension du widget

Si vous voulez ajouter des sections :

```javascript
// 1. Ajouter l'ID dans sectionIds (client script)
var sectionIds = [
    'description', /* ... */, 
    'resources', 
    'nouvelle-section'  // ← Ajout
];

// 2. Ajouter le bouton dans la nav (template)
<button class="fha-doc-nav-btn" 
        ng-class="{'active': c.activeSection === 'nouvelle-section'}" 
        ng-click="c.scrollToSection('nouvelle-section')">
    <i class="fa fa-star"></i> ${Nouvelle Section}
</button>

// 3. Ajouter la section avec ID (template)
<div id="nouvelle-section" class="fha-doc-section">
    <h2><i class="fa fa-star"></i> ${Nouvelle Section}</h2>
    <!-- Contenu -->
</div>
```

#### 2. Personnalisation CSS

Pour adapter les couleurs sans modifier le widget :

```css
/* Créer un override CSS dans sp_page ou sp_theme */
.fha-doc-header {
    background: linear-gradient(135deg, #custom1, #custom2) !important;
}

.fha-doc-nav-btn.active {
    background: #custom-color !important;
}
```

#### 3. Debugging

Activer les logs AngularJS :

```javascript
// Dans le client script, ajouter après api.controller=function(...) {
console.log('[FHA Doc] Controller initialized');
console.log('[FHA Doc] Active section:', c.activeSection);
console.log('[FHA Doc] Data:', c.data);
```

---

## Dépendances

### Framework et bibliothèques

| Dépendance | Version | Source | Obligatoire | Notes |
|------------|---------|--------|-------------|-------|
| **ServiceNow Service Portal** | Instance | Platform | ✅ Oui | Framework hôte |
| **AngularJS** | `glide.buildname` | ServiceNow | ✅ Oui | Fourni par le portail |
| **Font Awesome** | `glide.buildname` | ServiceNow | ✅ Oui | Icônes via classes `fa` |
| **IntersectionObserver** | Native | Browser | ⚠️ Recommandé | Fallback gracieux si absent |

### Compatibilité navigateurs

| Navigateur | Version minimale | Support IntersectionObserver |
|------------|------------------|------------------------------|
| Chrome | 58+ | ✅ Oui |
| Firefox | 55+ | ✅ Oui |
| Safari | 12.1+ | ✅ Oui |
| Edge | 16+ | ✅ Oui |
| IE 11 | - | ❌ Non (fallback OK) |

**Note** : Sans `IntersectionObserver`, le scroll spy ne fonctionne pas, mais le reste du widget reste opérationnel.

### Dépendances ServiceNow

| Table/Record | Sys ID | Relation |
|--------------|--------|----------|
| `sp_page` (fha_documentation) | `277a975c8392f21083e1b4a6feaad318` | Conteneur de la page |
| `sp_widget` (FHA Documentation) | `5ada939c8392f21083e1b4a6feaad360` | Widget source |
| `sp_instance` | `148ddbd083d2f21083e1b4a6feaad31d` | Instance du widget sur la page |
| System Properties | `x_1310794_founda_0.*` | Configuration dynamique |

### Version minimale ServiceNow

**Recommandé** : ServiceNow **Paris** ou supérieur

**Raisons** :
- Service Portal moderne
- AngularJS 1.7+
- Support IntersectionObserver (polyfill possible)

---

## Références

### Fichiers sources

| Fichier | Path complet | Taille | Description |
|---------|--------------|--------|-------------|
| **Widget XML** | `d852994c8312321083e1b4a6feaad3e6/update/sp_widget_5ada939c8392f21083e1b4a6feaad360.xml` | 1084 lignes | Définition complète du widget |
| **Page XML** | `d852994c8312321083e1b4a6feaad3e6/update/sp_page_277a975c8392f21083e1b4a6feaad318.xml` | 32 lignes | Page Service Portal |
| **Instance XML** | `d852994c8312321083e1b4a6feaad3e6/update/sp_instance_148ddbd083d2f21083e1b4a6feaad31d.xml` | 55 lignes | Instance widget |

### Documentation liée

- **API REST** : `docs/api/endpoints.md`
- **Workflow d'analyse** : `docs/features/analysis-workflow.md`
- **Architecture globale** : `docs/architecture.md`
- **Guide de déploiement** : `docs/guides/deployment.md`
- **Tests** : `docs/guides/testing.md`

### Scripts Include liés

Mentionnés dans le widget :

- `FHAnalyzer` - Point d'entrée API
- `FHAnalysisEngine` - Moteur d'orchestration
- `FHCheckTable` - Module de vérification tables
- `FHCheckAutomation` - Module de vérification automation
- `FHCheckIntegration` - Module de vérification intégrations
- `FHAnalysisContext` - Contexte d'analyse
- `FHCheckRegistry` - Registre des checks

### Changelog du widget

| Version | Date | Modifications |
|---------|------|---------------|
| **1.2.0-doc** | 2026-01-16 | Documentation technique complète avec détails d'implémentation |
| **1.1.1-doc** | 2026-01-14 | Ajout scroll spy (IntersectionObserver) et lecture system properties |
| **1.1.0-doc** | 2026-01-14 | Refonte page documentation avec 10 sections complètes |
| **1.0.0** | 2026-01-03 | Version initiale du widget |

---

## Métriques du widget

### Complexité

- **Lignes de code client** : ~60 lignes (AngularJS)
- **Lignes de code serveur** : ~10 lignes (GlideRecord properties)
- **Lignes de template** : ~550 lignes (HTML)
- **Lignes de CSS** : ~490 lignes
- **Total** : ~1110 lignes

### Performance

| Métrique | Valeur estimée | Notes |
|----------|----------------|-------|
| **Temps de chargement** | < 500ms | Sans cache |
| **Poids total** | ~50 KB | HTML + CSS inline |
| **Nombre de requêtes HTTP** | 1 | Widget autonome |
| **Scroll spy overhead** | Négligeable | IntersectionObserver natif |

### Sections documentaires

- **Nombre de sections** : 10
- **Nombre de boutons navigation** : 10
- **Nombre de tableaux** : 14
- **Nombre de blocs de code** : 5
- **Nombre d'info boxes** : 8
- **Nombre d'icônes Font Awesome** : ~50

---

**Auteur** : Foundation Health Analyzer Team  
**Licence** : Propriétaire (scope ServiceNow)  
**Support** : Via rôles `x_1310794_founda_0.admin`
