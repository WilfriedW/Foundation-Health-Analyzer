<!-- ===================================================== -->
<!-- FHA Category Metrics Widget - HTML Template -->
<!-- ===================================================== -->

<div class="fha-category-metrics">
  
  <!-- Loading State -->
  <div ng-if="c.data.loading" class="loading-container">
    <i class="fa fa-spinner fa-spin fa-3x"></i>
    <p>{{::c.data.i18n.loading}}</p>
  </div>

  <!-- Error State -->
  <div ng-if="c.data.error" class="alert alert-danger">
    <i class="fa fa-exclamation-triangle"></i>
    {{c.data.error}}
  </div>

  <!-- Content -->
  <div ng-if="!c.data.loading && !c.data.error">
    
    <!-- Header -->
    <div class="widget-header">
      <h3>
        <i class="fa fa-pie-chart"></i>
        {{::c.data.i18n.title}}
      </h3>
      <button class="btn btn-sm btn-default" ng-click="c.refreshData()">
        <i class="fa fa-refresh" ng-class="{'fa-spin': c.data.refreshing}"></i>
      </button>
    </div>

    <!-- No Data State -->
    <div ng-if="c.data.categoriesArray.length === 0" class="empty-state">
      <i class="fa fa-inbox fa-3x"></i>
      <p>{{::c.data.i18n.noData}}</p>
    </div>

    <!-- Categories Grid -->
    <div ng-if="c.data.categoriesArray.length > 0" class="categories-container">
      
      <!-- Category Card -->
      <div class="category-card" 
           ng-repeat="category in c.data.categoriesArray track by category.name"
           ng-click="c.selectCategory(category)"
           ng-class="{'selected': c.data.selectedCategory === category.name}">
        
        <div class="category-header">
          <div class="category-icon" ng-style="{'background-color': c.getCategoryColor(category.name)}">
            <i class="fa" ng-class="c.getCategoryIcon(category.name)"></i>
          </div>
          <div class="category-info">
            <h4>{{c.getCategoryLabel(category.name)}}</h4>
            <small class="text-muted">{{category.name}}</small>
          </div>
        </div>

        <div class="category-body">
          
          <!-- Total Issues -->
          <div class="stat-row main-stat">
            <span class="stat-label">{{::c.data.i18n.totalIssues}}</span>
            <span class="stat-value">{{category.total_issues | number:0}}</span>
          </div>

          <!-- Issues Breakdown -->
          <div class="severity-breakdown">
            <div class="severity-item" ng-if="category.critical > 0">
              <span class="severity-badge critical">
                <i class="fa fa-times-circle"></i>
                {{category.critical}}
              </span>
              <span class="severity-label">{{::c.data.i18n.critical}}</span>
            </div>
            <div class="severity-item" ng-if="category.high > 0">
              <span class="severity-badge high">
                <i class="fa fa-exclamation-triangle"></i>
                {{category.high}}
              </span>
              <span class="severity-label">{{::c.data.i18n.high}}</span>
            </div>
            <div class="severity-item" ng-if="category.medium > 0">
              <span class="severity-badge medium">
                <i class="fa fa-exclamation"></i>
                {{category.medium}}
              </span>
              <span class="severity-label">{{::c.data.i18n.medium}}</span>
            </div>
            <div class="severity-item" ng-if="category.low > 0">
              <span class="severity-badge low">
                <i class="fa fa-info-circle"></i>
                {{category.low}}
              </span>
              <span class="severity-label">{{::c.data.i18n.low}}</span>
            </div>
          </div>

          <!-- Affected Tables -->
          <div class="stat-row">
            <span class="stat-label">
              <i class="fa fa-database"></i>
              {{::c.data.i18n.affectedTables}}
            </span>
            <span class="stat-value">{{category.affected_tables_count}}</span>
          </div>

          <!-- Percentage -->
          <div class="percentage-bar">
            <div class="percentage-fill" 
                 ng-style="{'width': c.calculatePercentage(category.total_issues) + '%', 'background-color': c.getCategoryColor(category.name)}">
            </div>
          </div>
          <div class="percentage-text">
            {{c.calculatePercentage(category.total_issues)}}% {{::c.data.i18n.ofTotal}}
          </div>

        </div>

      </div>

    </div>

    <!-- Chart Section -->
    <div class="chart-section" ng-if="c.data.categoriesArray.length > 0">
      <div class="chart-header">
        <h4>{{::c.data.i18n.issuesByCategory}}</h4>
        <div class="chart-type-selector">
          <button class="btn btn-xs" 
                  ng-class="{'btn-primary': c.data.chartType === 'bar', 'btn-default': c.data.chartType !== 'bar'}"
                  ng-click="c.changeChartType('bar')">
            <i class="fa fa-bar-chart"></i>
          </button>
          <button class="btn btn-xs" 
                  ng-class="{'btn-primary': c.data.chartType === 'pie', 'btn-default': c.data.chartType !== 'pie'}"
                  ng-click="c.changeChartType('pie')">
            <i class="fa fa-pie-chart"></i>
          </button>
        </div>
      </div>
      <div class="chart-body">
        <canvas id="category-chart-{{c.widget.options.id}}" height="300"></canvas>
      </div>
    </div>

  </div>

</div>
