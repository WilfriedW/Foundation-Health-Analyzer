<!-- ===================================================== -->
<!-- FHA Executive Dashboard Widget - HTML Template -->
<!-- ===================================================== -->

<div class="fha-executive-dashboard">
  
  <!-- Loading State -->
  <div ng-if="c.data.loading" class="loading-container">
    <i class="fa fa-spinner fa-spin fa-3x"></i>
    <p>{{::c.data.i18n.loading}}</p>
  </div>

  <!-- Error State -->
  <div ng-if="c.data.error" class="alert alert-danger">
    <i class="fa fa-exclamation-triangle"></i>
    {{c.data.error}}
  </div>

  <!-- Dashboard Content -->
  <div ng-if="!c.data.loading && !c.data.error">
    
    <!-- Header -->
    <div class="dashboard-header">
      <h2>
        <i class="fa fa-dashboard"></i>
        {{::c.data.i18n.title}}
      </h2>
      <div class="header-actions">
        <button class="btn btn-default btn-sm" ng-click="c.refreshDashboard()">
          <i class="fa fa-refresh" ng-class="{'fa-spin': c.data.refreshing}"></i>
          {{::c.data.i18n.refresh}}
        </button>
        <span class="last-update">
          {{::c.data.i18n.lastUpdate}}: {{c.data.lastUpdate | date:'short'}}
        </span>
      </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-cards-container">
      
      <!-- Total Analyses -->
      <div class="kpi-card kpi-primary">
        <div class="kpi-icon">
          <i class="fa fa-line-chart"></i>
        </div>
        <div class="kpi-content">
          <div class="kpi-value">{{c.data.metrics.total_analyses | number:0}}</div>
          <div class="kpi-label">{{::c.data.i18n.totalAnalyses}}</div>
          <div class="kpi-sublabel">
            <span class="badge badge-info">{{c.data.metrics.analyses_last_30_days}} {{::c.data.i18n.last30Days}}</span>
          </div>
        </div>
      </div>

      <!-- Average Health Score -->
      <div class="kpi-card" ng-class="c.getHealthScoreClass(c.data.metrics.avg_health_score)">
        <div class="kpi-icon">
          <i class="fa fa-heartbeat"></i>
        </div>
        <div class="kpi-content">
          <div class="kpi-value">{{c.data.metrics.avg_health_score}}%</div>
          <div class="kpi-label">{{::c.data.i18n.avgHealthScore}}</div>
          <div class="kpi-progress">
            <div class="progress">
              <div class="progress-bar" 
                   ng-class="c.getHealthScoreProgressClass(c.data.metrics.avg_health_score)"
                   ng-style="{'width': c.data.metrics.avg_health_score + '%'}">
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Issues -->
      <div class="kpi-card kpi-warning">
        <div class="kpi-icon">
          <i class="fa fa-exclamation-circle"></i>
        </div>
        <div class="kpi-content">
          <div class="kpi-value">{{c.data.metrics.total_issues | number:0}}</div>
          <div class="kpi-label">{{::c.data.i18n.totalIssues}}</div>
          <div class="kpi-breakdown">
            <span class="issue-badge critical" ng-if="c.data.metrics.critical_issues > 0">
              <i class="fa fa-times-circle"></i> {{c.data.metrics.critical_issues}}
            </span>
            <span class="issue-badge high" ng-if="c.data.metrics.high_severity_issues > 0">
              <i class="fa fa-exclamation-triangle"></i> {{c.data.metrics.high_severity_issues}}
            </span>
            <span class="issue-badge medium" ng-if="c.data.metrics.medium_severity_issues > 0">
              <i class="fa fa-exclamation"></i> {{c.data.metrics.medium_severity_issues}}
            </span>
          </div>
        </div>
      </div>

      <!-- Tables Analyzed -->
      <div class="kpi-card kpi-info">
        <div class="kpi-icon">
          <i class="fa fa-database"></i>
        </div>
        <div class="kpi-content">
          <div class="kpi-value">{{c.data.metrics.tables_analyzed}}</div>
          <div class="kpi-label">{{::c.data.i18n.tablesAnalyzed}}</div>
          <div class="kpi-sublabel">
            <span class="badge badge-success">{{c.data.metrics.active_configurations}} {{::c.data.i18n.activeConfigs}}</span>
          </div>
        </div>
      </div>

      <!-- Success Rate -->
      <div class="kpi-card kpi-success">
        <div class="kpi-icon">
          <i class="fa fa-check-circle"></i>
        </div>
        <div class="kpi-content">
          <div class="kpi-value">{{c.data.metrics.success_rate}}%</div>
          <div class="kpi-label">{{::c.data.i18n.successRate}}</div>
          <div class="kpi-progress">
            <div class="progress">
              <div class="progress-bar progress-bar-success" 
                   ng-style="{'width': c.data.metrics.success_rate + '%'}">
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      
      <!-- Health Score Distribution (Donut Chart) -->
      <div class="chart-card chart-half">
        <div class="chart-header">
          <h3>
            <i class="fa fa-pie-chart"></i>
            {{::c.data.i18n.healthScoreDistribution}}
          </h3>
        </div>
        <div class="chart-body">
          <canvas id="health-distribution-chart-{{c.widget.options.id}}" height="250"></canvas>
        </div>
      </div>

      <!-- Trending Chart (Line Chart) -->
      <div class="chart-card chart-half">
        <div class="chart-header">
          <h3>
            <i class="fa fa-area-chart"></i>
            {{::c.data.i18n.healthScoreTrend}}
          </h3>
          <div class="chart-controls">
            <button class="btn btn-xs" 
                    ng-class="{'btn-primary': c.data.trendingDays == 7, 'btn-default': c.data.trendingDays != 7}"
                    ng-click="c.changeTrendingPeriod(7)">
              7d
            </button>
            <button class="btn btn-xs" 
                    ng-class="{'btn-primary': c.data.trendingDays == 30, 'btn-default': c.data.trendingDays != 30}"
                    ng-click="c.changeTrendingPeriod(30)">
              30d
            </button>
            <button class="btn btn-xs" 
                    ng-class="{'btn-primary': c.data.trendingDays == 60, 'btn-default': c.data.trendingDays != 60}"
                    ng-click="c.changeTrendingPeriod(60)">
              60d
            </button>
            <button class="btn btn-xs" 
                    ng-class="{'btn-primary': c.data.trendingDays == 90, 'btn-default': c.data.trendingDays != 90}"
                    ng-click="c.changeTrendingPeriod(90)">
              90d
            </button>
          </div>
        </div>
        <div class="chart-body">
          <canvas id="trending-chart-{{c.widget.options.id}}" height="250"></canvas>
        </div>
      </div>

    </div>

    <!-- Top 10 Problematic Tables -->
    <div class="tables-section">
      <div class="section-header">
        <h3>
          <i class="fa fa-warning"></i>
          {{::c.data.i18n.topProblematicTables}}
        </h3>
        <a href="/fha-tables" class="view-all-link">
          {{::c.data.i18n.viewAll}} <i class="fa fa-arrow-right"></i>
        </a>
      </div>
      
      <div class="tables-grid" ng-if="c.data.topTables.length > 0">
        <div class="table-card" ng-repeat="table in c.data.topTables track by table.table_name">
          <div class="table-card-header">
            <div class="table-info">
              <h4>{{table.table_label}}</h4>
              <small class="text-muted">{{table.table_name}}</small>
            </div>
            <div class="table-score" ng-class="c.getHealthScoreClass(table.health_score)">
              <span class="score-value">{{table.health_score}}%</span>
            </div>
          </div>
          <div class="table-card-body">
            <div class="issue-summary">
              <span class="issue-count critical" ng-if="table.critical > 0" title="Critical">
                <i class="fa fa-times-circle"></i> {{table.critical}}
              </span>
              <span class="issue-count high" ng-if="table.high > 0" title="High">
                <i class="fa fa-exclamation-triangle"></i> {{table.high}}
              </span>
              <span class="issue-count medium" ng-if="table.medium > 0" title="Medium">
                <i class="fa fa-exclamation"></i> {{table.medium}}
              </span>
              <span class="issue-count low" ng-if="table.low > 0" title="Low">
                <i class="fa fa-info-circle"></i> {{table.low}}
              </span>
            </div>
            <div class="total-issues">
              <strong>{{table.total_issues}}</strong> {{::c.data.i18n.totalIssues}}
            </div>
            <div class="last-analysis">
              <i class="fa fa-clock-o"></i>
              {{table.last_analysis | date:'short'}}
            </div>
          </div>
          <div class="table-card-footer">
            <a href="/fha?table={{table.table_name}}" class="btn btn-sm btn-default">
              {{::c.data.i18n.viewDetails}}
            </a>
          </div>
        </div>
      </div>

      <div class="empty-state" ng-if="c.data.topTables.length === 0">
        <i class="fa fa-check-circle fa-3x"></i>
        <p>{{::c.data.i18n.noProblematicTables}}</p>
      </div>
    </div>

  </div>

</div>
