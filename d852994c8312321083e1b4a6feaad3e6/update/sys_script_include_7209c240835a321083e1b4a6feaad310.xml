<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>package_private</access>
        <active>false</active>
        <api_name>x_1310794_founda_0.FHCheckAutomation</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <mobile_callable>false</mobile_callable>
        <name>FHCheckAutomation</name>
        <sandbox_callable>false</sandbox_callable>
        <script><![CDATA[var FHCheckAutomation = Class.create();
FHCheckAutomation.prototype = {
    initialize: function() {
        this.optionsHandler = new FHOptionsHandler();
        this.utils = new FHScanUtils();
    },

    /**
     * execute(ctx)
     * Primary public entrypoint to execute automation checks.     *
     * @param {Object} ctx - FHAnalysisContext
     */
    execute: function(ctx) {
        if (!ctx) return;
        ctx.registerCategory('automation', 'Automation', 'fa-cogs');

        // Get tables to check from centralized context logic
        var tablesToCheck = ctx.getTablesToCheck();

        // Run individual checks 
        this.checkScheduledJobs(ctx, tablesToCheck);
        this.checkFlows(ctx, tablesToCheck);
        this.checkWorkflows(ctx, tablesToCheck);
        this.checkNotifications(ctx, tablesToCheck);
        this.checkUIActions(ctx, tablesToCheck);
        this.checkUIPolicies(ctx, tablesToCheck);
        this.checkInboundEmailActions(ctx, tablesToCheck);
        //this.checkInboundEmailFlows(ctx, tablesToCheck);


        // if (ctx.config.deep_scan) this.optionsHandler.deepScanScripts(ctx);
        // if (ctx.config.analyze_references) this.optionsHandler.analyzeIntegrationDependencies(ctx);
        // if (ctx.config.include_ldap) this.optionsHandler.analyzeLdapConfiguration(ctx);
    },

    // Specific scheduled jobs checker â€” uses the generic above.
    checkScheduledJobs: function(ctx, configTables) {
        var query = configTables.map(function(t) {
            return 'scriptLIKE' + t;
        }).join('^OR');
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sysauto_script', function(gr) {
            gr.addEncodedQuery(query);
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sysauto_script',
            record_type: 'scheduled_job',
            displayName: 'Scheduled Jobs',
            icon: 'fa-clock',
            color: '#6f42c1',
            inactivityIssueCode: 'INACTIVE_SCHEDULED_JOB',
            category: 'automation',
            manyThreshold: 50,
            manyIssueCode: 'MANY_SCHEDULED_JOBS'
        });
    },

    /**
     * checkFlows(ctx, configTables)
     * Check flows (sys_hub_flow) for trigger_table matching our config tables.
     */
    checkFlows: function(ctx, configTables) {
        flowIds = [];
        for (var x = 0; x < configTables.length; x++) {
            var result = sn_flow.AssociatedFlows.getFlows(configTables[x]);
            flowIds.push(result);
        }
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sys_hub_flow', function(gr) {
            gr.addEncodedQuery("sys_idIN" + flowIds.join(','));
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sys_hub_flow',
            record_type: 'flow',
            displayName: 'Flows',
            icon: 'fa-project-diagram',
            color: '#17a2b8',
            category: 'automation',
            inactivityIssueCode: 'INACTIVE_FLOW',
            manyThreshold: 10,
            manyIssueCode: 'MANY_FLOWS',
        });
    },

    /**
     * checkWorkflows(ctx, configTables)
     * Legacy workflows (wf_workflow) that target our tables.
     */
    checkWorkflows: function(ctx, configTables) {

        return this.utils.checkRecordsGeneric(ctx, configTables, 'wf_workflow', function(gr) {
            gr.addEncodedQuery("tableIN" + configTables);
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'wf_workflow',
            record_type: 'workflow',
            displayName: 'Workflows',
            icon: 'fa-project-diagram',
            color: '#6610f2',
            category: 'automation',
            manyThreshold: 10,
            manyIssueCode: 'MANY_WORKFLOWS',
            skipManyIssue: false
        });
        // var tableName = ctx.getTableName();

        // var transform = function(rec) {
        //     var triggerTable = rec.table;
        //     return {
        //         sys_id: rec.sys_id,
        //         name: rec.name || 'Unnamed',
        //         table: 'wf_workflow',
        //         trigger_table: triggerTable,
        //         inherited: (triggerTable !== tableName),
        //         active: rec.active,
        //         published: rec.published,
        //         description: rec.description,
        //         sys_created_by: rec.sys_created_by,
        //         sys_updated_by: rec.sys_updated_by
        //     };
        // };

        // var postProcess = function(localCtx, item) {
        //     if (!item) return;

        //     var code = null;
        //     var msg = null;
        //     if (item.published === false || item.published === 'false') {
        //         code = 'UNPUBLISHED_WORKFLOW';
        //         msg = 'Unpublished workflow: "' + (item.name || 'Unnamed') + '"';
        //     } else if (!this.utils.toBool(item.active)) {
        //         code = 'INACTIVE_WORKFLOW';
        //         msg = 'Inactive workflow: "' + (item.name || 'Unnamed') + '"';
        //     }

        //     if (code) {
        //         this.utils.addIssueUnlessSnc(localCtx, code, msg, 'low', {
        //             record_table: 'wf_workflow',
        //             record_sys_id: item.sys_id,
        //             category: 'automation'
        //         }, item);
        //     }
        // }.bind(this);


    },

    /**
     * checkNotifications(ctx, configTables)
     * Notifications that reference the table in conditions or scripts.
     */
    checkNotifications: function(ctx, configTables) {
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sysevent_email_action', function(gr) {
            gr.addEncodedQuery("collectionIN" + configTables);
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sysevent_email_action',
            record_type: 'notification',
            displayName: 'Notifications',
            icon: 'fa-bell',
            color: '#ffc107',
            category: 'automation',
            inactivityIssueCode: 'INACTIVE_NOTIFICATION'
        });
    },

    /**
     * checkUIActions(ctx, configTables)
     * UI Actions (sys_ui_action) related to our tables.
     */
    checkUIActions: function(ctx, configTables) {
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sys_ui_action', function(gr) {
            gr.addEncodedQuery("tableIN" + configTables);
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sys_ui_action',
            record_type: 'ui_action',
            displayName: 'UI Actions',
            icon: 'fa-mouse-pointer',
            color: '#007bff',
            category: 'automation',
            inactivityIssueCode: 'INACTIVE_UI_ACTION',
            manyThreshold: 25,
            manyIssueCode: 'MANY_UI_ACTIONS',
            record_filter: 'tableIN' + configTables.join(',')
        });
    },

    /**
     * checkUIPolicies(ctx, configTables)
     * UI Policies (sys_ui_policy) for the tables.
     */
    checkUIPolicies: function(ctx, configTables) {
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sys_ui_policy', function(gr) {
            gr.addEncodedQuery("tableIN" + configTables);
        }, ['short_description', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sys_ui_policy',
            record_type: 'ui_policy',
            displayName: 'UI Policies',
            icon: 'fa-shield-alt',
            color: '#20c997',
            category: 'automation',
            manyThreshold: 15,
            manyIssueCode: 'MANY_UI_POLICIES',
        });
    },

    /**
     * checkInboundEmailActions(ctx, configTables)
     * Check inbound email actions and flow trigger instances related to email.
     */
    checkInboundEmailActions: function(ctx, configTables) {
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sysevent_in_email_action', function(gr) {
            gr.addEncodedQuery("tableIN" + configTables);
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sysevent_in_email_action',
            record_type: 'inbound_email',
            displayName: 'Inbound Email Actions',
            icon: 'fa-inbox',
            color: '#e83e8c',
            category: 'automation',
            inactivityIssueCode: 'INACTIVE_INBOUND_EMAIL',
            skipCategoryAndMetrics: true,
            skipManyIssue: true
        });
    },

    checkInboundEmailFlows: function(ctx, configTables) {
        return this.utils.checkRecordsGeneric(ctx, configTables, 'sys_hub_trigger_instance', function(gr) {
            gr.addQuery('trigger_type', 'IS', 'email');
            gr.addQuery('trigger_config', 'LIKE', tableToCheck);
        }, ['name', 'active', 'sys_created_by', 'sys_updated_by', 'sys_id'], {
            record_table: 'sys_hub_trigger_instance',
            record_type: 'inbound_email_flow',
            displayName: 'Inbound Email flows',
            icon: 'fa-inbox',
            color: '#e83e8c',
            category: 'automation',
            inactivityIssueCode: 'INACTIVE_INBOUND_FLOWS',
            skipCategoryAndMetrics: true,
            skipManyIssue: true
        });
    },


    type: 'FHCheckAutomation'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2026-01-02 23:21:10</sys_created_on>
        <sys_id>7209c240835a321083e1b4a6feaad310</sys_id>
        <sys_mod_count>124</sys_mod_count>
        <sys_name>FHCheckAutomation</sys_name>
        <sys_package display_value="Foundation Health Analyzer" source="x_1310794_founda_0">d852994c8312321083e1b4a6feaad3e6</sys_package>
        <sys_policy>read</sys_policy>
        <sys_scope display_value="Foundation Health Analyzer">d852994c8312321083e1b4a6feaad3e6</sys_scope>
        <sys_update_name>sys_script_include_7209c240835a321083e1b4a6feaad310</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2026-01-07 01:03:11</sys_updated_on>
    </sys_script_include>
</record_update>
